<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>每月工作概览</title>
    <link href="../../res/admin/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../../res/admin/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../res/admin/css/bootstrap-combobox.css" rel="stylesheet">

    <!-- Toastr style -->
    <link href="../../res/admin/css/plugins/toastr/toastr.min.css" rel="stylesheet">

    <!-- Sweet Alert -->
    <link href="../../res/admin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">

    <link href="../../res/admin/css/animate.css" rel="stylesheet">
    <link href="../../res/admin/css/style.css" rel="stylesheet">

    <!-- Data picker -->
    <link href="../../res/admin/css/plugins/datapicker/datepicker3.css" rel="stylesheet">

    <!-- TouchSpin -->
    <link href="../../res/admin/css/plugins/touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet">

    <style>
        h2 {
            font-weight: 600;
        }
    </style>
</head>

<body class="gray-bg">
    <div id="inner-wrapper">
        <div id="search-form" style="margin: 10px 0;">
            <div class="form-inline">
                <div class="form-group">
                    <div class="input-group date">
                        <span class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </span>
                        <input id="year_month" type="text" class="form-control" value="" placeholder="选择月份">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="doGlobalViewSearch()">查询</button>
            </div>
        </div>

        <h2>整体概况</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>平台电梯数</h5>
                    </div>
                    <div class="ibox-content">
                        <div>
                            <canvas id="lineChart-elevator" height="140"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>平台人员数</h5>
                    </div>
                    <div class="ibox-content">
                        <div>
                            <canvas id="lineChart-staff" height="140"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px;">
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>电梯数</th>
                                    <th>人数</th>
                                    <th>急修次数</th>
                                    <th>维保次数</th>
                                    <th>自检次数</th>
                                </tr>
                            </thead>
                            <tbody id="total_view">

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>

        <h2>急修概况</h2>
        <div class="row">
            <div class="ibox ">
                <div class="ibox-content ">
                    <div class="col-md-6">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group ">
                                    <span class="input-group-addon gray-bg">故障高发项目前</span>
                                    <input type="text" id="project_num" class="form-control" value="10">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="doRushHighProjectSearch()">查询</button>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>项目</th>
                                    <th>电梯数</th>
                                    <th>本月总故障次数</th>
                                    <th>本月平均故障率</th>
                                </tr>
                            </thead>
                            <tbody id="project_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="ibox ">
                <div class="ibox-content ">
                    <div class="col-md-6">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group ">
                                    <span class="input-group-addon gray-bg">故障高发电梯前</span>
                                    <input type="text" id="elevator_num" class="form-control" value="10">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="doRushHighElevatorSearch()">查询</button>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>电梯号</th>
                                    <th>项目</th>
                                    <th>报修次数</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="elevator_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px;">
            <h3 style="padding-left: 35px;">本月停梯次数</h3>
            <div class="col-md-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>本月停梯</th>
                                    <th>本月未复梯</th>
                                </tr>
                            </thead>
                            <tbody id="stop_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <h2>维保概况</h2>
        <div class="row">
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>电梯数</th>
                                    <th>维保总任务数</th>
                                    <th>其他维保任务数</th>
                                    <th>结果补录</th>
                                    <th>异常关闭</th>
                                    <th>超期工单</th>
                                    <th>发现问题</th>
                                    <th>确认问题</th>
                                </tr>
                            </thead>
                            <tbody id="maintain_info">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px;">
            <div class="ibox ">
                <div class="ibox-content ">
                    <div class="col-md-6">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group ">
                                    <span class="input-group-addon gray-bg">异常操作前</span>
                                    <input type="text" id="maintain_error_num" class="form-control" value="10">
                                </div>
                            </div>
                            <label>员工</label>
                            <button class="btn btn-primary" onclick="doMaintainErrorSearch()">查询</button>
                        </div>

                    </div>

                    <div class="col-md-12">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>电梯数</th>
                                    <th>维保总任务数</th>
                                    <th>结果补录</th>
                                    <th>异常关闭</th>
                                    <th>超期工单</th>
                                    <th>操作地点异常</th>
                                </tr>
                            </thead>
                            <tbody id="maintain_error">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px;">
            <div class="ibox ">
                <div class="ibox-content ">
                    <div class="col-md-6">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group ">
                                    <span class="input-group-addon">发现问题前</span>
                                    <input type="text" id="maintain_find_num" class="form-control" value="10">
                                </div>
                            </div>
                            <label>员工</label>
                            <button class="btn btn-primary" onclick="doMaintainFindSearch()">查询</button>
                        </div>

                    </div>

                    <div class="col-md-12">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>电梯数</th>
                                    <th>维保总任务数</th>
                                    <th>发现问题数</th>
                                    <th>确认问题数</th>
                                </tr>
                            </thead>
                            <tbody id="maintain_find">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <h2>大修/整改概况</h2>
        <div class="row">
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>本月新增大修/整改</th>
                                    <th>本月未完成大修/整改</th>
                                    <th>超期工单</th>
                                </tr>
                            </thead>
                            <tbody id="big_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <h2>年检概况</h2>
        <div class="row">
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>本月年检次数</th>
                                    <th>年检合格数</th>
                                    <th>年检不合格工单</th>
                                    <th>异常关闭工单</th>
                                </tr>
                            </thead>
                            <tbody id="year_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>本月年检自检次数</th>
                                    <th>年检自检合格数</th>
                                    <th>整改项</th>
                                    <th>年检自检不合格工单</th>
                                    <th>需复检工单</th>
                                    <th>异常关闭工单</th>
                                </tr>
                            </thead>
                            <tbody id="year_self_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <h2>自检概况</h2>
        <div class="row">
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th>自检次数</th>
                                    <th>整改项</th>
                                    <th>自检异常工单</th>
                                    <th>自检不合格工单</th>
                                    <th>需复检工单</th>
                                    <th>复检不合格</th>
                                </tr>
                            </thead>
                            <tbody id="check_info">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

        <div class="row" style="margin-bottom: 20px;">
            <div class="ibox ">
                <div class="ibox-content ">
                    <div class="col-md-6">
                        <div class="form-inline">
                            <div class="form-group">
                                <div class="input-group ">
                                    <span class="input-group-addon gray-bg">自检问题最多前</span>
                                    <input type="text" id="check_num" class="form-control" value="10">
                                </div>
                            </div>
                            <label>电梯</label>
                            <button class="btn btn-primary" onclick="doCheckMostSearch()">查询</button>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>本月自检次数</th>
                                    <th>整改项</th>
                                    <th>维保责任人</th>
                                    <th>详细工单</th>

                                </tr>
                            </thead>
                            <tbody id="check_most_info">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" style="margin-bottom: 20px;">
            <h3 style="padding-left: 35px;">复检不合格电梯</h3>
            <div class="col-lg-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table  table-hover">
                            <thead class="gray-bg">
                                <tr>
                                    <th></th>
                                    <th>本月自检次数</th>
                                    <th>整改项</th>
                                    <th>维保责任人</th>
                                    <th>详细工单</th>

                                </tr>
                            </thead>
                            <tbody id="check_fail">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="modal inmodal" id="win" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-lg" style="width: 90%;">
            <div class="modal-content animated fadeIn">

            </div>
        </div>
    </div>

    <script src="../../res/admin/js/jquery-2.1.1.js"></script>
    <script src="../../res/admin/js/bootstrap.min.js"></script>
    <script src="../../res/admin/js/bootstrap-combobox.js"></script>

    <!-- Toastr script -->
    <script src="../../res/admin/js/plugins/toastr/toastr.min.js"></script>

    <!-- Sweet alert -->
    <script src="../../res/admin/js/plugins/sweetalert/sweetalert.min.js"></script>

    <script src="https://cdn.bootcss.com/blueimp-md5/2.6.0/js/md5.js"></script>
    <script src="../../res/admin/js/app.js"></script>

    <!-- Data picker -->
    <script src="../../res/admin/js/plugins/datapicker/bootstrap-datepicker.js"></script>
    <script src="../../res/admin/js/plugins/datapicker/locales/bootstrap-datepicker.zh-CN.js"></script>

    <!-- TouchSpin -->
    <script src="../../res/admin/js/plugins/touchspin/jquery.bootstrap-touchspin.min.js"></script>

    <!-- ChartJS-->
    <script src="../../res/admin/js/plugins/chartJs/Chart.min.js"></script>

    <script src="../../res/admin/js/plugins/fullcalendar/moment.min.js"></script>
    <script>
        var lineOptions = {
            scaleShowGridLines: true,
            scaleGridLineColor: "rgba(0,0,0,.05)",
            scaleGridLineWidth: 1,
            bezierCurve: true,
            bezierCurveTension: 0.4,
            pointDot: true,
            pointDotRadius: 4,
            pointDotStrokeWidth: 1,
            pointHitDetectionRadius: 20,
            datasetStroke: true,
            datasetStrokeWidth: 2,
            datasetFill: true,
            responsive: true,
        };
        $(document).ready(function () {
            $("#location", window.parent.document).html("后台管理 >数据分析 >每月工作概览");

            var date = new Date();
            var m = date.getMonth() + 1;
            var y = date.getFullYear();
            var year_month = y;
            if (m < 10) {
                m = '0' + m;
            }
            $("#year_month").val(y + '-' + m);
            $('.input-group.date').datepicker({
                language: 'zh-CN',
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true,
                startView: 1,
                maxViewMode: 1,
                minViewMode: 1,
                format: "yyyy-mm"
            });

            $("#project_num").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("#elevator_num").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("#maintain_error_num").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("#maintain_find_num").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("#check_num").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            doGlobalViewSearch();

            $("#win").on("hidden.bs.modal", function () {
                $(this).removeData("bs.modal");
            });
        });

        function doGlobalViewSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var options = {
                url: 'GetGeneralSituation',
                data: {
                    MonthTime: parseInt(MonthTime),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        var _tM = res.data.ThisMonth;
                        var _lM = res.data.LastMonth;
                        $("#total_view").empty();
                        var tr1 = "<tr><td>本月</td>"
                            + "<td>" + _tM.ElevatorCount + "</td>"
                            + "<td>" + _tM.PersonCount + "</td>"
                            + "<td>" + _tM.CheckAndFixCount + "</td>"
                            + "<td>" + _tM.MaintainCount + "</td>"
                            + "<td>" + parseInt(_tM.SelfCheckCount + _tM.YearSelfCount) + "</td>"
                            + "</tr>";
                        var tr2 = "<tr><td>上月</td>"
                            + "<td>" + _lM.ElevatorCount + "</td>"
                            + "<td>" + _lM.PersonCount + "</td>"
                            + "<td>" + _lM.CheckAndFixCount + "</td>"
                            + "<td>" + _lM.MaintainCount + "</td>"
                            + "<td>" + parseInt(_lM.SelfCheckCount + _lM.YearSelfCount) + "</td>"
                            + "</tr>";
                        var tr3 = "<tr><td>增加</td>"
                            + "<td>" + (parseInt(_tM.ElevatorCount) - parseInt(_lM.ElevatorCount)) + "</td>"
                            + "<td>" + (parseInt(_tM.PersonCount) - parseInt(_lM.PersonCount)) + "</td>"
                            + "<td>" + (parseInt(_tM.CheckAndFixCount) - parseInt(_lM.CheckAndFixCount)) + "</td>"
                            + "<td>" + (parseInt(_tM.MaintainCount) - parseInt(_lM.MaintainCount)) + "</td>"
                            + "<td>" + (parseInt(_tM.SelfCheckCount + _tM.YearSelfCount) - parseInt(_lM.SelfCheckCount + _lM.YearSelfCount)) + "</td>"
                            + "</tr>";
                        $("#total_view").append(tr1);
                        $("#total_view").append(tr2);
                        $("#total_view").append(tr3);

                        var labels = [];
                        for (var i = 11; i >= 0; i--) {
                            var label = moment(app.formatDateFromUnix(MonthTime)).subtract(i, 'months');
                            label = app.formatDateFromUnix(new Date(label).getTime() / 1000).substr(0, 7);
                            labels.push(label);
                        }

                        var div = $("#lineChart-elevator").parent();
                        $(div).empty();
                        $(div).html('<canvas id="lineChart-elevator" height="140"></canvas>');
                        //平台电梯数
                        var elevatorData = {
                            labels: labels,
                            datasets: [
                                {
                                    label: "平台电梯数",
                                    fillColor: "rgba(26,179,148,0.5)",
                                    strokeColor: "rgba(26,179,148,0.7)",
                                    pointColor: "rgba(26,179,148,1)",
                                    pointStrokeColor: "#fff",
                                    pointHighlightFill: "#fff",
                                    pointHighlightStroke: "rgba(26,179,148,1)",
                                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                                }
                            ]
                        };
                        var elevator = document.getElementById("lineChart-elevator").getContext("2d");
                        var elevatorChart = new Chart(elevator).Line(elevatorData, lineOptions);

                        var div = $("#lineChart-staff").parent();
                        $(div).empty();
                        $(div).html('<canvas id="lineChart-staff" height="140"></canvas>');
                        //平台人员数
                        var staffData = {
                            labels: labels,
                            datasets: [
                                {
                                    label: "Example dataset",
                                    fillColor: "rgba(26,179,148,0.5)",
                                    strokeColor: "rgba(26,179,148,0.7)",
                                    pointColor: "rgba(26,179,148,1)",
                                    pointStrokeColor: "#fff",
                                    pointHighlightFill: "#fff",
                                    pointHighlightStroke: "rgba(26,179,148,1)",
                                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                                }
                            ]
                        };
                        var staff = document.getElementById("lineChart-staff").getContext("2d");
                        var staffChart = new Chart(staff).Line(staffData, lineOptions);

                        elevatorChart.datasets[0].points[0].value = 0;
                        elevatorChart.datasets[0].points[1].value = 0;
                        elevatorChart.datasets[0].points[2].value = 0;
                        elevatorChart.datasets[0].points[3].value = 0;
                        elevatorChart.datasets[0].points[4].value = 0;
                        elevatorChart.datasets[0].points[5].value = 0;
                        elevatorChart.datasets[0].points[6].value = 0;
                        elevatorChart.datasets[0].points[7].value = 0;
                        elevatorChart.datasets[0].points[8].value = 0;
                        elevatorChart.datasets[0].points[9].value = 0;
                        elevatorChart.datasets[0].points[10].value = 0;
                        elevatorChart.datasets[0].points[11].value = 0;

                        staffChart.datasets[0].points[0].value = 0;
                        staffChart.datasets[0].points[1].value = 0;
                        staffChart.datasets[0].points[2].value = 0;
                        staffChart.datasets[0].points[3].value = 0;
                        staffChart.datasets[0].points[4].value = 0;
                        staffChart.datasets[0].points[5].value = 0;
                        staffChart.datasets[0].points[6].value = 0;
                        staffChart.datasets[0].points[7].value = 0;
                        staffChart.datasets[0].points[8].value = 0;
                        staffChart.datasets[0].points[9].value = 0;
                        staffChart.datasets[0].points[10].value = 0;
                        staffChart.datasets[0].points[11].value = 0;
                        var list = res.data.List;
                        if (list && list.length > 0) {
                            list.forEach(function (v, i, a) {
                                var Month = app.formatDateFromUnix(v.DateNum).substr(0, 7);
                                for (var i = 0; i < labels.length; i++) {
                                    if (Month == labels[i]) {
                                        elevatorChart.datasets[0].points[i].value = v.ElevatorCount;
                                        staffChart.datasets[0].points[i].value = v.PersonCount;
                                    }
                                }
                            })
                        }
                        elevatorChart.update();
                        staffChart.update();

                        $("#stop_info").empty();
                        var tr = "<tr>"
                            + "<td>" + _tM.CheckStopCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(2,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + "<td>" + _tM.CheckStillStopCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(3,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + "</tr>";
                        $("#stop_info").html(tr);

                        $("#maintain_info").empty();
                        var tr = '<tr>'
                            + '<td>上月</td>'
                            + '<td>' + _lM.MaintainElevatorCount + '</td>'
                            + '<td>' + _lM.MaintainCount + '</td>'
                            + '<td>' + _lM.OtherMaintainCount + '</td>'
                            + '<td>' + _lM.MaintainFixCount + '</td>'
                            + '<td>' + _lM.MaintainUnusualCloseCount + '</td>'
                            + '<td>' + _lM.MaintainExpireCount + '</td>'
                            + '<td>' + _lM.MaintainFindCount + '</td>'
                            + '<td>' + _lM.MaintainConfirmCount + '</td>'
                            + '</tr>'
                            + '<tr>'
                            + '<td>本月</td>'
                            + '<td>' + _tM.MaintainElevatorCount + '</td>'
                            + '<td>' + _tM.MaintainCount + '</td>'
                            + '<td>' + _tM.OtherMaintainCount + '</td>'
                            + '<td>' + _tM.MaintainFixCount + '</td>'
                            + '<td>' + _tM.MaintainUnusualCloseCount + '</td>'
                            + '<td>' + _tM.MaintainExpireCount + '</td>'
                            + '<td>' + _tM.MaintainFindCount + '</td>'
                            + '<td>' + _tM.MaintainConfirmCount + '</td>'
                            + '</tr>';
                        $("#maintain_info").html(tr);

                        $("#big_info").empty();
                        var tr = '<tr>'
                            + '<td>' + _tM.BigCheckAndFixCount + '</td>'
                            + '<td>' + _tM.UnfinishBigCheckAndFixCount + '</td>'
                            + '<td>' + _tM.BigCheckAndFixExpireCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(9,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '</tr>';
                        $("#big_info").html(tr);

                        $("#year_info").empty();
                        var tr = '<tr>'
                            + '<td>' + _tM.YearCount + '</td>'
                            + '<td>' + _tM.PassYearCount + '</td>'
                            + '<td>' + _tM.FailYearCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(10,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.YearUnusualCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(11,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '</tr>';
                        $("#year_info").html(tr);

                        $("#year_self_info").empty();
                        var tr = '<tr>'
                            + '<td>' + _tM.YearSelfCount + '</td>'
                            + '<td>' + _tM.PassYearSelfCount + '</td>'
                            + '<td>' + _tM.YearSelfCheckToBigCount + '</td>'
                            + '<td>' + _tM.FailYearSelfCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(12,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.RecheckYearSelfCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(18,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.YearSelfUnusualCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(13,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '</tr>';
                        $("#year_self_info").html(tr);

                        $("#check_info").empty();
                        var tr = '<tr>'
                            + '<td>' + _tM.SelfCheckCount + '</td>'
                            + '<td>' + _tM.SelfCheckToBigCount + '</td>'
                            + '<td>' + _tM.SelfCheckUnusualCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(14,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.SelfCheckFailCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(15,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.RecheckSelfCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(19,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '<td>' + _tM.SelfCheckRecheckFailCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(16,\"\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                            + '</tr>';
                        $("#check_info").html(tr);
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);

            doRushHighProjectSearch();
            doRushHighElevatorSearch();
            doMaintainErrorSearch();
            doMaintainFindSearch();
            doCheckMostSearch();

            var options = {
                url: 'GetTopGeneralSelfRecheckFailElevator',
                data: {
                    MonthTime: parseInt(MonthTime),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#check_fail").empty();
                        if (res.data.List && res.data.List.length > 0) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = '<tr>'
                                    + '<td>' + v.ElevatorNum + '</td>'
                                    + '<td>' + v.SelfCheckCount + '</td>'
                                    + '<td>' + v.SelfCheckToBigCount + '</td>'
                                    + '<td>' + v.DutyPerson + '</td>'
                                    + '<td>' + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(16,\"" + v.ElevatorNum + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + '</tr>';
                                $("#check_fail").html(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doRushHighProjectSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var TopNum = $("#project_num").val();
            if (TopNum == "") {
                TopNum = 10;
            }

            var options = {
                url: 'GetTopGeneralCheckProject',
                data: {
                    MonthTime: parseInt(MonthTime),
                    TopNum: parseInt(TopNum),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#project_info").empty();
                        if (res.data.List) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = "<tr>"
                                    + "<td>" + v.ProjectName + "</td>"
                                    + "<td>" + v.ElevatorCount + "</td>"
                                    + "<td>" + v.ErrorCount + "</td>"
                                    + "<td>" + (v.AllElevatorCount == 0 ? 0 : (parseInt(v.ErrorCount) / parseInt(v.AllElevatorCount)).toFixed(2)) + "</td>"
                                    + "</tr>";
                                $("#project_info").append(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doRushHighElevatorSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var TopNum = $("#elevator_num").val();
            if (TopNum == "") {
                TopNum = 10;
            }

            var options = {
                url: 'GetTopGeneralCheckElevator',
                data: {
                    MonthTime: parseInt(MonthTime),
                    TopNum: parseInt(TopNum),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#elevator_info").empty();
                        if (res.data.List) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = "<tr>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.ProjectName + "</td>"
                                    + "<td>" + v.TicketCount + "</td>"
                                    + "<td><a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(1,\"" + v.ElevatorNum + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "</tr>";
                                $("#elevator_info").append(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doMaintainErrorSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var TopNum = $("#maintain_error_num").val();
            if (TopNum == "") {
                TopNum = 10;
            }

            var options = {
                url: 'GetTopGeneralMaintainUnusaulPerson',
                data: {
                    MonthTime: parseInt(MonthTime),
                    TopNum: parseInt(TopNum),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#maintain_error").empty();
                        if (res.data.List) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = "<tr>"
                                    + "<td>" + v.Name + "</td>"
                                    + "<td>" + v.ElevatorCount + "</td>"
                                    + "<td>" + v.TicketCount + "</td>"
                                    + "<td>" + v.FixCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(4,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "<td>" + v.UnusualCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(5,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "<td>" + v.ExpireCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(6,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "<td>" + v.UnusualAddressCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(17,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "</tr>";
                                $("#maintain_error").append(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doMaintainFindSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var TopNum = $("#maintain_find_num").val();
            if (TopNum == "") {
                TopNum = 10;
            }

            var options = {
                url: 'GetTopGeneralMaintainFindPerson',
                data: {
                    MonthTime: parseInt(MonthTime),
                    TopNum: parseInt(TopNum),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#maintain_find").empty();
                        if (res.data.List) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = "<tr>"
                                    + "<td>" + v.Name + "</td>"
                                    + "<td>" + v.ElevatorCount + "</td>"
                                    + "<td>" + v.TicketCount + "</td>"
                                    + "<td>" + v.FindCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(7,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "<td>" + v.ConfirmCount + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(8,\"" + v.UserName + ":" + v.Name + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "</tr>";
                                $("#maintain_find").append(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doCheckMostSearch() {
            var MonthTime = $("#year_month").val();
            if (MonthTime == "") {
                var date = new Date();
                var m = date.getMonth() + 1;
                var y = date.getFullYear();
                var year_month = y;
                if (m < 10) {
                    m = '0' + m;
                }
                MonthTime = y + '-' + m
            }
            MonthTime += '-01';
            MonthTime = new Date(MonthTime).getTime() / 1000;

            var TopNum = $("#check_num").val();
            if (TopNum == "") {
                TopNum = 10;
            }

            var options = {
                url: 'GetTopGeneralSelfElevator',
                data: {
                    MonthTime: parseInt(MonthTime),
                    TopNum: parseInt(TopNum),
                },
                callback: function (res, params) {
                    res = eval("(" + res + ")");
                    if (res.code == 10000) {
                        $("#check_most_info").empty();
                        if (res.data.List) {
                            res.data.List.forEach(function (v, i, a) {
                                var tr = "<tr>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.SelfCheckCount + "</td>"
                                    + "<td>" + v.SelfCheckToBigCount + "</td>"
                                    + "<td>" + v.DutyPerson + "</td>"
                                    + '<td>' + " <a style='color:#134da5;' href='ticket_list.html' onclick='doPrepareDetail(17,\"" + v.ElevatorNum + "\"," + MonthTime + ")' data-toggle='modal' data-target='#win'><i class='fa fa-info'></i>&nbsp;详细工单</a></td>"
                                    + "</tr>";
                                $("#check_most_info").append(tr);
                            })
                        }
                    } else {
                        app.error(res.msg);
                    }
                },
                callback_params: {}
            };

            app.execPostRequest(options);
        }

        function doPrepareDetail(index, key, MonthTime) {
            var start = app.formatDateFromUnix(MonthTime);
            var end = moment(start).endOf('month').format("YYYY-MM-DD");
            var options = {};
            if (index == 1) {
                //电梯检修
                options = {
                    url: 'GetElevatorCheckAndFixTicketInfo',
                    data: {
                        State: -1,
                        PropertyName: '',
                        BuildingName: '',
                        ProjectName: '',
                        ElevatorNum: key,
                        TicketStartTime: new Date(start).getTime() / 1000,
                        TicketEndTime: new Date(end).getTime() / 1000 + 86400,
                        IsStop: "",
                        Start: 0,
                        Num: -1,
                    },
                };
            } else if (index == 2) {
                //本月停梯
                options = {
                    url: 'GetElevatorCheckAndFixTicketInfo',
                    data: {
                        State: -1,
                        PropertyName: '',
                        BuildingName: '',
                        ProjectName: '',
                        ElevatorNum: "",
                        TicketStartTime: new Date(start).getTime() / 1000,
                        TicketEndTime: new Date(end).getTime() / 1000 + 86400,
                        IsStop: "停过梯",
                        Start: 0,
                        Num: -1,
                    },
                };
            } else if (index == 3) {
                //本月未复梯
                options = {
                    url: 'GetGeneralCheckStillStopTicket',
                    data: {
                        MonthTime: parseInt(MonthTime)
                    },
                };
            } else if (index == 4
                || index == 5
                || index == 6
                || index == 7
                || index == 8
                || index == 17
            ) {
                //维保
                var UserName = key.split(":")[0];
                var Name = key.split(":")[1];
                var type = 0;
                switch (index) {
                    case 4:
                        type = 1;
                        break;
                    case 5:
                        type = 2;
                        break;
                    case 6:
                        type = 3;
                        break;
                    case 7:
                        type = 4;
                        break;
                    case 8:
                        type = 5;
                        break;
                    case 17:
                        type = 9;
                        break;
                }
                options = {
                    url: 'GetGeneralMaintainTickeyByPerson',
                    Name: Name,
                    data: {
                        MonthTime: parseInt(MonthTime),
                        UserName: UserName,
                        Type: type,
                    },
                };
            } else if (index == 9) {
                //大修整改
                options = {
                    url: 'GetGeneralBigExpireTicket',
                    data: {
                        MonthTime: parseInt(MonthTime),
                    },
                };
            } else if (index == 12
                || index == 13
                || index == 18
            ) {
                var IsSelfCheckPass = "";
                var IsRecheck = "";
                if (index == 12) {
                    IsSelfCheckPass = "不合格";
                } else if (index == 13) {
                    IsSelfCheckPass = "异常关闭";
                } else if (index == 18) {
                    IsRecheck = "复检"
                }
                options = {
                    url: 'GetElevatorYearCheckTicketInfo',
                    data: {
                        State: -1,
                        PropertyName: '',
                        BuildingName: '',
                        ProjectName: '',
                        ElevatorNum: '',
                        TicketSelfStartTime: new Date(start).getTime() / 1000,
                        TicketSelfEndTime: new Date(end).getTime() / 1000 + 86400,
                        IsSelfCheckPass: IsSelfCheckPass,
                        IsExpire: "",
                        IsRecheck: IsRecheck,
                        Start: 0,
                        Num: -1,
                    }
                };
            } else if (index == 10 || index == 11) {
                var IsPass = "";
                if (index == 10) {
                    IsPass = "不合格";
                } else if (index == 11) {
                    IsPass = "异常关闭";
                }
                options = {
                    url: 'GetElevatorYearCheckTicketInfo',
                    data: {
                        State: -1,
                        PropertyName: '',
                        BuildingName: '',
                        ProjectName: '',
                        ElevatorNum: '',
                        TicketStartTime: new Date(start).getTime() / 1000,
                        TicketEndTime: new Date(end).getTime() / 1000 + 86400,
                        IsPass: IsPass,
                        IsExpire: "",
                        Start: 0,
                        Num: -1,
                    }
                };
            } else if (index == 14 || index == 15 || index == 19) {
                //自检有异常，不合格
                var IsPass = "";
                var IsRecheck = "";
                if (index == 14) {
                    IsPass = "有异常";
                } else if (index == 15) {
                    IsPass = "不合格";
                } else if (index == 19) {
                    IsRecheck = "复检"
                }
                options = {
                    url: 'GetElevatorSelfCheckTicketInfo',
                    data: {
                        State: -1,
                        PropertyName: '',
                        BuildingName: '',
                        ProjectName: '',
                        ElevatorNum: key,
                        TicketStartTime: new Date(start).getTime() / 1000,
                        TicketEndTime: new Date(end).getTime() / 1000 + 86400,
                        IsPass: IsPass,
                        IsRecheck: IsRecheck,
                        IsExpire: "",
                        Start: 0,
                        Num: -1,
                    }
                };
            } else if (index == 16) {
                //自检复检不合格
                options = {
                    url: 'GetGeneralSelfRecheckTicket',
                    data: {
                        MonthTime: parseInt(MonthTime),
                        ElevatorNum: key,
                    }
                };
            }

            app.setWinOptions(options);
        }
    </script>
</body>

</html>