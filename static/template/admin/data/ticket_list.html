<div class="modal-header" style="padding: 15px">
    <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true" style="font-size: 30px;">&times;</span>
        <span class="sr-only">Close</span>
    </button>
    <h6 class="modal-title">详细工单</h6>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 id="w_h5"></h5>
                </div>
                <div class="ibox-content">

                    <table class="table table-striped table-hover">
                        <thead id="w_th">
                        </thead>
                        <tbody id="w_tb">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-white" data-dismiss="modal">返回</button>
</div>
<script>
    $(function () {

        if (app.win_options.url == "GetElevatorCheckAndFixTicketInfo") {
            $("#w_h5").html(app.win_options.data.ElevatorNum + "&nbsp;" + app.formatDateFromUnix(app.win_options.data.TicketStartTime).substr(0, 7) + " 急修工单");
        } else if (app.win_options.url == "GetGeneralCheckStillStopTicket") {
            $("#w_h5").html(app.formatDateFromUnix(app.win_options.data.MonthTime).substr(0, 7) + " 急修工单");
        } else if (app.win_options.url == "GetGeneralMaintainTickeyByPerson") {
            var html = "";
            switch (app.win_options.data.Type) {
                case 1: {
                    html = "结果补录";
                    break;
                }
                case 2: {
                    html = "异常关闭";
                    break;
                }
                case 3: {
                    html = "超期工单";
                    break;
                }
                case 4: {
                    html = "发现问题";
                    break;
                }
                case 5: {
                    html = "确认问题";
                    break;
                }
            }

            $("#w_h5").html(app.win_options.Name + " " + app.formatDateFromUnix(app.win_options.data.MonthTime).substr(0, 7) + " " + html + " 维保工单");
        } else if (app.win_options.url == "GetGeneralBigExpireTicket") {
            $("#w_h5").html(app.formatDateFromUnix(app.win_options.data.MonthTime).substr(0, 7) + " 大修整改工单");
        } else if (app.win_options.url == "GetElevatorYearCheckTicketInfo") {
            var html = "";
            if (app.win_options.data.IsPass == "不合格" || app.win_options.data.IsPass == "异常关闭") {
                html = "年检 " + app.win_options.data.IsPass
            }
            if (app.win_options.data.IsSelfCheckPass == "不合格" || app.win_options.data.IsSelfCheckPass == "异常关闭") {
                html = "年检自检 " + app.win_options.data.IsSelfCheckPass
            }

            $("#w_h5").html(app.formatDateFromUnix(app.win_options.data.TicketStartTime).substr(0, 7) + " " + html);
        } else if (app.win_options.url == "GetElevatorSelfCheckTicketInfo") {
            $("#w_h5").html(app.win_options.data.ElevatorNum + " " + app.formatDateFromUnix(app.win_options.data.TicketStartTime).substr(0, 7) + " 自检 " + app.win_options.data.IsPass);
        } else if (app.win_options.url == "GetGeneralSelfRecheckTicket") {
            $("#w_h5").html(app.win_options.data.ElevatorNum + " " + app.formatDateFromUnix(app.win_options.data.TicketStartTime).substr(0, 7) + " 自检 复检不合格");
        }

        var th = "";
        if (app.win_options.url == "GetElevatorCheckAndFixTicketInfo"
            || app.win_options.url == "GetGeneralCheckStillStopTicket"
        ) {
            //检修
            th = "<tr>"
                + "<th>工单</th>"
                + "<th>电梯编号</th>"
                + "<th>工单状态</th>"
                + "<th>当前处理人</th>"
                + "<th>报修时间</th>"
                + "<th>完成时间</th>"
                + "<th>问题信息</th>"
                + "<th>操作</th>"
                + "</tr>";
        } else if (app.win_options.url == "GetGeneralMaintainTickeyByPerson") {
            th = "<tr>"
                + "<th>工单</th>"
                + "<th>工作类型</th>"
                + "<th>电梯编号</th>"
                + "<th>工单状态</th>"
                + "<th>当前处理人</th>"
                + "<th>计划维保时间</th>"
                + "<th>实际完成时间</th>"
                + "<th>是否超期</th>"
                + "<th>操作</th>"
                + "</tr>";
        } else if (app.win_options.url == "GetGeneralBigExpireTicket") {
            th = "<tr>"
                + "<th>工单</th>"
                + "<th>电梯编号</th>"
                + "<th>工单类型</th>"
                + "<th>工单状态</th>"
                + "<th>当前处理人</th>"
                + "<th>报修时间</th>"
                + "<th>工作说明</th>"
                + "<th>操作</th>"
                + "</tr>";
        } else if (app.win_options.url == "GetElevatorYearCheckTicketInfo") {
            th = "<tr>"
                + "<th>工单</th>"
                + "<th>电梯编号</th>"
                + "<th>工单状态</th>"
                + "<th>当前处理人</th>"
                + "<th>上次年检时间</th>"
                + "<th>本次年检自检时间</th>"
                + "<th>是否超期</th>"
                + "<th>年检自检结果</th>"
                + "<th>年检结果</th>"
                + "<th>操作</th>"
                + "</tr>";
        } else if (app.win_options.url == "GetElevatorSelfCheckTicketInfo"
            || app.win_options.url == "GetGeneralSelfRecheckTicket"
        ) {
            th = "<tr>"
                + "<th>工单</th>"
                + "<th>电梯编号</th>"
                + "<th>工单状态</th>"
                + "<th>自检人员</th>"
                + "<th>自检项目</th>"
                + "<th>自检时间</th>"
                + "<th>是否超期</th>"
                + "<th>自检结果</th>"
                + "<th>操作</th>"
                + "</tr>";
        }

        $("#w_th").html(th);

        var options = {
            url: app.win_options.url,
            data: app.win_options.data,
            callback: function (res, params) {
//                alert(res);
                res = eval("(" + res + ")");
                if (res.code == 10000) {
                    if (app.win_options.url == "GetElevatorCheckAndFixTicketInfo") {
                        //检修
                        if (res.data.Result && res.data.Result.length > 0) {
                            res.data.Result.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_check_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_check_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";
                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ActualTime) + "</td>"
                                    + "<td>" + v.ProblemDesc + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";
                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetGeneralCheckStillStopTicket") {
                        //本月仍未复梯
                        if (res.data.List && res.data.List.length > 0) {
                            res.data.List.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_check_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_check_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";

                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ActualTime) + "</td>"
                                    + "<td>" + v.ProblemDesc + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";

                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetGeneralMaintainTickeyByPerson") {
                        if (res.data.List && res.data.List.length > 0) {
                            res.data.List.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_maintain_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_maintain_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";

                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.MaintainProjectName + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ActualTime) + "</td>"
                                    + "<td>" + (v.IsExpire == true ? '是' : '否') + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";

                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetGeneralBigExpireTicket") {
                        if (res.data.List && res.data.List.length > 0) {
                            res.data.List.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                        ;
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_big_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_big_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";

                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.TicketType + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + v.ProblemDesc + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";

                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetElevatorYearCheckTicketInfo") {
                        //检修
                        if (res.data.Result && res.data.Result.length > 0) {
                            res.data.Result.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_year_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_year_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";
                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.LastYearCheckTime) + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + (v.IsExpire == true ? '已超期' : '未超期') + "</td>"
                                    + "<td>" + v.IsSelfCheckPass + "</td>"
                                    + "<td>" + v.IsPass + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";
                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetElevatorSelfCheckTicketInfo") {
                        //检修
                        if (res.data.Result && res.data.Result.length > 0) {
                            res.data.Result.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_filter_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_filter_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";
                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + v.SelfCheckProjectName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + (v.IsExpire == true ? '已超期' : '未超期') + "</td>"
                                    + "<td>" + v.IsPass + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";
                                $("#w_tb").append(tb);
                            })
                        }
                    }
                    else if (app.win_options.url == "GetGeneralSelfRecheckTicket") {
                        if (res.data.List && res.data.List.length > 0) {
                            res.data.List.forEach(function (v, i, a) {
                                var tb = "";

                                var DutyPersonName = "";
                                if (v.DutyPersonName && v.DutyPersonName.length > 0) {
                                    v.DutyPersonName.forEach(function (vv, ii, aa) {
                                        if (vv.trim() != "") {
                                            DutyPersonName += vv + "、";
                                        }
                                    })
                                }
                                if (DutyPersonName.length > 0) {
                                    DutyPersonName = DutyPersonName.substr(0, DutyPersonName.length - 1);
                                }

                                var url_tip = "../protect/lift_filter_tip.html?key=" + encodeURIComponent(v.TicketID);
                                var url_history = "../protect/lift_filter_history.html?key=" + encodeURIComponent(v.TicketID);
                                var opt = "<a style='color:#134da5;' data-href='" + url_tip + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-info'></i>&nbsp;更多信息</a>"
                                    + "&nbsp;|&nbsp;"
                                    + "<a style='color:#134da5;' data-href='" + url_history + "' onclick='javascript:app.openWinFromWin(this)' ><i class='fa fa-history'></i>&nbsp;处理历史</a>";

                                tb = "<tr>"
                                    + "<td>" + v.TicketID + "</td>"
                                    + "<td>" + v.ElevatorNum + "</td>"
                                    + "<td>" + v.State + "</td>"
                                    + "<td>" + DutyPersonName + "</td>"
                                    + "<td>" + v.SelfCheckProjectName + "</td>"
                                    + "<td>" + app.formatDateFromUnix(v.ShouldDealTime) + "</td>"
                                    + "<td>" + (v.IsExpire == true ? '已超期' : '未超期') + "</td>"
                                    + "<td>" + v.IsPass + "</td>"
                                    + "<td>" + opt + "</td>"
                                    + "</tr>";

                                $("#w_tb").append(tb);
                            })
                        }
                    }
                } else {
                    app.error(res.msg);
                }
            },
            callback_params: {}
        }

        app.execPostRequest(options);
    });
</script>