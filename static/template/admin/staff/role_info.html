<div class="modal-header" style="padding: 15px">
    <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true" style="font-size: 30px;">&times;</span>
        <span class="sr-only">Close</span>
    </button>
    <h6 class="modal-title">新增角色</h6>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>角色信息</h5>
                </div>
                <div class="ibox-content">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="input-required">*</span>角色名称
                            </label>

                            <div class="col-sm-10">
                                <input type="text" id="w_role" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                角色描述
                            </label>
                            <div class="col-sm-10">
                                <input type="text" id="w_desc" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ibox">
                <div class="ibox-title">
                    <h5>管理权限</h5>
                </div>
                <div class="ibox-content">
                    <div class="ibox">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="w_pick_all"  value="" >&nbsp;全选
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="档案及人员管理">&nbsp;档案及人员管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="项目制定与全局管理">&nbsp;项目制定与全局管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="保养管理">&nbsp;保养管理
                                </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="检修管理">&nbsp;检修管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="大修/整改管理">&nbsp;大修/整改管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="自检管理">&nbsp;自检管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="年检管理">&nbsp;年检管理
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="check-inline i-checks checkbox-more"> 
                                        <input type="checkbox" name="models"  value="仓库管理">&nbsp;仓库管理
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-white" data-dismiss="modal">返回</button>
    <button type="button" class="btn btn-primary" onclick="saveRoleInfo()">确认</button>
</div>
<script>
    var ElevatorType = "直梯";
    $(function () {
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
        app.win_action = 'add';
        if (app.win_url.indexOf("?key=") > 0) {
            app.win_action = 'edit';
            app.win_key = app.win_url.split("?key=")[1];
        }

        $("input[name='w_pick_all']").on('ifClicked', function (event) {
            if (!$(this).is(":checked")) {
                $("input[name='models']").each(function () {
                    $(this).iCheck('check')
                });
            } else {
                $("input[name='models']").each(function () {
                    $(this).iCheck('uncheck')
                });
            }
        });

        if (app.win_action == 'edit') {
            //编辑页面
            $(".modal-title").html("编辑维保项目")

            //获取info
            var options = {
                url: 'GetRoleDetail',
                data: {
                    RoleName: app.win_key,
                },
                callback: initRoleInfo,
                callback_params: {}
            };

            app.execPostRequest(options);

        }
    });

    function initRoleInfo(res, params) {
        res = eval("(" + res + ")");
        if (res.code == 10000) {
            if (res.data == null) {
                return;
            }

            var info = res.data;
            $("#w_role").val(info.RoleName);
            $("#w_desc").val(info.RoleDesc);
            if (info.AuthorityList && info.AuthorityList.length > 0) {
                info.AuthorityList.forEach(function (v, i, a) {
                    $("input[name='models'][value='" + v + "']").iCheck('check');
                });
            }
        } else {
            app.error(res.msg)
        }
    }

    function saveRoleInfo() {
        var RoleName = $("#w_role").val().trim();
        var RoleDesc = $("#w_desc").val().trim();
        if (RoleName == "") {
            app.warning("请输入角色名称");
            return;
        }

        var AuthorityList = [];
        $("input[name='models']").each(function () {
            if ($(this).is(":checked")) {
                var item = $(this).val();
                AuthorityList.push(item);
            }
        });
        if (app.win_action == 'add') {
            var options = {
                url: 'AddRole',
                data: {
                    RoleName: RoleName,
                    RoleDesc: RoleDesc,
                    AuthorityList: AuthorityList,
                },
                callback: app.saveCallbackWindow,
                callback_params: {
                    action: "add",
                    refresh: role_refresh,
                    key: RoleName,
                }
            };

            app.execPostRequest(options);
        } else {
            var options = {
                url: 'ChangeRole',
                data: {
                    RoleName: RoleName,
                    RoleDesc: RoleDesc,
                    AuthorityList: AuthorityList,
                },
                callback: app.saveCallbackWindow,
                callback_params: {
                    action: "edit",
                    refresh: role_refresh,
                    key: app.win_key,
                }
            };

            app.execPostRequest(options);
        }
    }

</script>