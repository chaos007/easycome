<div class="modal-header" style="padding: 15px">
    <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true" style="font-size: 30px;">&times;</span>
        <span class="sr-only">Close</span>
    </button>
    <h6 class="modal-title">补充结算信息</h6>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="input-required">*</span>最终金额
                            </label>

                            <div class="col-sm-10">
                                <input type="text" id="w_final_money" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="input-required">*</span>开票金额</label>
                            <div class="col-sm-10">
                                <input type="text" id="w_account_money" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="input-required">*</span>开票日期</label>
                            <div class="col-sm-10">
                                <div class="input-group date">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                    <input id="w_account_date" type="text" class="form-control" value="" placeholder="选择日期">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="input-required">*</span>发票号码</label>
                            <div class="col-sm-10">
                                <input type="text" id="w_account_num" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal">返回</button>
        <button type="button" class="btn btn-primary" onclick="saveInfo()">确认</button>
    </div>
    <script>

        $(function () {

            $("#w_final_money").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("#w_account_money").TouchSpin({
                max: 1000000,
                min: 0,
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $('.input-group.date').datepicker({
                language: 'zh-CN',
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true,
            });

            app.win_action = 'add';
            if (app.win_url.indexOf("?key=") > 0) {
                app.win_action = 'edit';
                app.win_key = decodeURIComponent(app.win_url.split("?key=")[1]);
            }

            if (app.win_action == 'edit') {
                //获取info
                var options = {
                    url: 'GetOfferWithKey',
                    data: {
                        ID: parseInt(app.win_key),
                    },
                    callback: initAccountInfo,
                    callback_params: {}
                };

                app.execPostRequest(options);
            }

        });



        function initAccountInfo(res, param) {
            res = eval("(" + res + ")");
            if (res.code == 10000) {
                if (res.data == null) {
                    return;
                }
                var info = res.data;
                $("#w_final_money").val(info.FinalMoney);
                $("#w_account_money").val(info.AccountMoney);
                $("#w_account_date").val(app.formatDateFromUnix(info.AccountDate));
                $("#w_account_num").val(info.AccountNum);
            }
        }

        function saveInfo() {
            var finalMoney = $("#w_final_money").val();
            var accountMoney = $("#w_account_money").val();
            var accountDate = $("#w_account_date").val();
            var accountNum = $("#w_account_num").val();


            if (finalMoney.trim() == "") {
                app.warning("请输入最终金额");
                return;
            }

            if (accountMoney.trim() == "") {
                app.warning("请输入开票金额");
                return;
            }

            if (accountDate.trim() == "") {
                app.warning("请输入开票日期");
                return;
            }

            if (accountNum.trim() == "") {
                app.warning("请输入发票号码");
                return;
            }

            var options = {
                url: 'SetOfferAccount',
                data: {
                    ID: parseInt(app.win_key),
                    FinalMoney: parseInt(finalMoney),
                    AccountMoney: parseInt(accountMoney),
                    AccountDate: parseInt(new Date(accountDate).getTime() / 1000),
                    AccountNum: accountNum,
                },
                callback: app.saveCallbackWindow,
                callback_params: {
                    action: "edit",
                    refresh: offer_refresh,
                    key: parseInt(app.win_key),
                }
            };

            app.execPostRequest(options);

        }

    </script>